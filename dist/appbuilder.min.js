/*! appbuilder 2013-06-25 */
define("text",["module"],function(a){var b,c,d,e,f=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],g=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,h=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,i="undefined"!=typeof location&&location.href,j=i&&location.protocol&&location.protocol.replace(/\:/,""),k=i&&location.hostname,l=i&&(location.port||void 0),m={},n=a.config&&a.config()||{};return b={version:"2.0.7",strip:function(a){if(a){a=a.replace(g,"");var b=a.match(h);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:n.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=f[b];try{a=new ActiveXObject(c)}catch(d){}if(a){f=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.indexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return-1!==f&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1,a.length)):b=a,d=c||b,f=d.indexOf("!"),-1!==f&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==c||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,n.isBuild&&(m[a]=d),e(d)},load:function(a,c,d,e){if(e.isBuild&&!e.inlineText)return d(),void 0;n.isBuild=e.isBuild;var f=b.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=c.toUrl(g),m=n.useXhr||b.useXhr;!i||m(h,j,k,l)?b.get(h,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([g],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)})},write:function(a,c,d){if(m.hasOwnProperty(c)){var e=b.jsEscape(m[c]);d.asModule(a+"!"+c,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=d.toUrl(g.moduleName+h)+".js";b.load(i,d,function(){var c=function(a){return e(j,a)};c.asModule=function(a,b){return e.asModule(a,j,b)},b.write(a,i,c,f)},f)}},"node"===n.env||!n.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(c=require.nodeRequire("fs"),b.get=function(a,b,d){try{var e=c.readFileSync(a,"utf8");0===e.indexOf("ï»¿")&&(e=e.substring(1)),b(e)}catch(f){d(f)}}):"xhr"===n.env||!n.env&&b.createXhr()?b.get=function(a,c,d,e){var f,g=b.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);n.onXhr&&n.onXhr(g,a),g.onreadystatechange=function(){var b,e;4===g.readyState&&(b=g.status,b>399&&600>b?(e=new Error(a+" HTTP status: "+b),e.xhr=g,d(e)):c(g.responseText),n.onXhrComplete&&n.onXhrComplete(g,a))},g.send(null)}:"rhino"===n.env||!n.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===n.env||!n.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(d=Components.classes,e=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),b.get=function(a,b){var c,f,g={},h=new FileUtils.File(a);try{c=d["@mozilla.org/network/file-input-stream;1"].createInstance(e.nsIFileInputStream),c.init(h,1,0,!1),f=d["@mozilla.org/intl/converter-input-stream;1"].createInstance(e.nsIConverterInputStream),f.init(c,"utf-8",c.available(),e.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),f.readString(c.available(),g),f.close(),c.close(),b(g.value)}catch(i){throw new Error((h&&h.path||"")+": "+i)}}),b}),define("text!appbuilder.html",[],function(){return'<div class="webmaker-appbuilder-connection-sentence">\n  <div>\n    When <select data-output-action></select>, <select data-input-action></select>.\n  </div>\n  <div>\n    <button data-action="accept">Accept</button><button data-action="cancel">Cancel</button>\n  </div>\n</div>\n<div class="webmaker-appbuilder-connection-list">\n  <ul>\n    <li class="connection-details">\n      <input type="checkbox" checked="checked">\n      <span data-description></span>\n    </li>\n  </ul>\n  <div>\n    <button data-action="accept">Accept</button><button data-action="cancel">Cancel</button>\n  </div>\n</div>'}),define("text!appbuilder.css",[],function(){return".webmaker-appbuilder-connection-sentence {\n  visibility: hidden;\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  text-align: center;\n  background-color: rgba(30, 30, 30, 0.85);\n  color: #fff;\n  padding: 5px;\n}\n\n.webmaker-appbuilder-connection-sentence.on {\n  visibility: visible;\n}\n\n.webmaker-appbuilder-connection-list {\n  visibility: hidden;\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  text-align: center;\n  background-color: rgba(30, 30, 30, 0.85);\n  color: #fff;\n  padding: 5px;\n}\n\n.webmaker-appbuilder-connection-list.on {\n  visibility: visible;\n}\n\n.webmaker-appbuilder-connection-list ul {\n  list-style: none;\n}\n"}),define("ui-util",[],function(){return{getDomFragmentFromString:function(a){var b=document.createElement("div");return b.innerHTML=a,b},attachCSSFromString:function(a){var b=document.createElement("style");b.innerHTML=a,document.head.appendChild(b)}}}),define("text!graph-ui.css",[],function(){return".webmaker-appbuilder-overlay {\n  position: absolute;\n  z-index: 9999;\n  background: rgba(60, 150, 250, 0.7);\n  opacity: 0;\n}\n\n.webmaker-appbuilder-overlay.on {\n  opacity: 1;\n}\n\n.webmaker-appbuilder-line {\n  -webkit-transform-origin: 5px 5px;\n     -moz-transform-origin: 5px 5px;\n      -ms-transform-origin: 5px 5px;\n       -o-transform-origin: 5px 5px;\n          transform-origin: 5px 5px;\n  position: absolute;\n  z-index: 9999;\n  border: 5px solid rgba(60, 250, 150, 0.8);\n  pointer-events: none;\n  margin-top: -2.5px;\n  margin-left: -2.5px;\n  border-radius: 5px;\n}"}),define("text!graph-ui.html",[],function(){return'<div class="webmaker-appbuilder-line"></div>\n<div class="webmaker-appbuilder-overlay"></div>\n'}),define("graph-ui",["text!graph-ui.css","text!graph-ui.html","ui-util"],function(a,b,c){function d(a,b){function c(){var c=f-a,d=g-b,h=Math.sqrt(c*c+d*d),i=180*Math.atan2(d,c)/Math.PI;e.style.width=h+"px";var j="rotate("+i.toFixed(3)+"deg)";e.style.transform=j,e.style.WebkitTransform=j,e.style.MozTransform=j}function d(a){f=a.clientX+document.body.scrollLeft,g=a.clientY+document.body.scrollTop,c()}var e=j.querySelector(".webmaker-appbuilder-line").cloneNode(!0),f=a,g=b;return e.style.left=a+"px",e.style.top=b+"px",window.addEventListener("mousemove",d,!1),e.stop=function(){window.removeEventListener("mousemove",d,!1)},c(),e}function e(a){function b(){d.classList.add("on"),f=a}function c(){d.classList.remove("on"),f=null}var d=j.querySelector(".webmaker-appbuilder-overlay").cloneNode(!0),e=setInterval(function(){var b=a.getBoundingClientRect();d.style.top=b.top+document.body.scrollTop+"px",d.style.left=b.left+document.body.scrollLeft+"px",d.style.width=b.width+"px",d.style.height=b.height+"px"},20);return d.addEventListener("mouseover",b,!1),d.addEventListener("mouseout",c,!1),d.turnOn=function(){d.classList.add("on")},d.stop=function(){clearInterval(e),d.removeEventListener("mouseover",b,!1),d.removeEventListener("mouseout",c,!1)},a._appbuilder.overlay=d,d}var f=null,g=[],h=[],i=null,j=c.getDomFragmentFromString(b);return c.attachCSSFromString(a),{addElement:function(a){g.push(a)},removeElement:function(a){var b=g.indexOf(a);b>-1&&g.splice(b,1)},createOverlays:function(){g.forEach(function(a){var b=e(a);document.body.appendChild(b),h.push(b)})},destroyOverlays:function(){for(;h.length>0;){var a=h.shift();a.stop(),a.parentNode.removeChild(a)}},createSpecificOverlay:function(a){var b=e(a);document.body.appendChild(b),b.classList.add("on"),h.push(b)},destroySpecificOverlay:function(a){a.classList.contains("webmaker-appbuilder-overlay")||(a=a._appbuilder.overlay),a.stop(),a.parentNode.removeChild(a);var b=h.indexOf(a);b>-1&&h.splice(b,1)},startDrawingPath:function(a,b){i=d(a,b),document.body.appendChild(i);for(var c=document.elementFromPoint(a,b);c&&!c._appbuilder;)c=c.parentNode;c&&(f=c,f._appbuilder.overlay.turnOn())},stopDrawingPath:function(){i.stop(),document.body.removeChild(i);var a=f;return f=null,a}}}),define("events",[],function(){function a(){var a="EventNamespace"+b++;return{on:function(b,c){var d=a+b;document.addEventListener(d,c,!1)},off:function(b,c){var d=a+b;document.removedEventListener(d,c,!1)},dispatch:function(b,c){var d=document.createEvent("CustomEvent"),e=a+b;d.initCustomEvent(e,!1,!1,c),document.dispatchEvent(d)}}}var b=0;return{createEventManager:a}}),define("connections",[],function(){function a(a,b,c,d){this.inputEndpoint=c,this.outputEndpoint=a,this.inputType=d,this.outputType=b,this.send=function(a){c.receive(d,a)}}function b(a,b){var c={},d={},e={_parent:a,getOutputConnections:function(){return c},getInputConnections:function(){return d},getOutputConnection:function(a,b,d){var e=c[a];if(e){var f;return e.forEach(function(a){a.inputEndpoint===b&&a.inputType===d&&(f=a)}),f}return null},addInputConnection:function(a){d[a.inputType]=d[a.inputType]||[],d[a.inputType].push(a)},addOutputConnection:function(a){c[a.outputType]=c[a.outputType]||[],c[a.outputType].push(a)},removeInputConnection:function(a){var b=d[a.inputType];if(b){var c=b.indexOf(a);c>-1&&b.splice(c,1)}},removeOutputConnection:function(a){var b=c[a.outputType];if(b){var d=b.indexOf(a);d>-1&&b.splice(d,1)}},send:function(a,b){var d=c[a];d&&d.forEach(function(a){a.send(b)})},receive:b};return e}return{createEndpoint:b,createConnection:function(b,c,d,e){return new a(b,c,d,e)}}}),define("appbuilder",["text!appbuilder.html","text!appbuilder.css","ui-util","graph-ui","events","connections"],function(a,b,c,d,e,f){function g(a,b,c){function d(){var a=Array.prototype.slice.call(i.querySelectorAll('input[type="checkbox"]')).filter(function(a){return!a.checked}).map(function(a){return a._connection});l.clear(),b&&b(a)}function e(){l.clear(),c&&c()}var f=n.querySelector('button[data-action="accept"]'),g=n.querySelector('button[data-action="cancel"]'),h=a._appbuilder.definition.outputs,i=n.querySelector("ul"),j=a._appbuilder.connections.getOutputConnections();i.innerHTML="";var k=[];Object.keys(j).forEach(function(b){j[b].forEach(function(c){var d=c.inputEndpoint._parent.definition.inputs[c.inputType].description,e=h[b].description;d=d.replace("{{name}}","the "+a._appbuilder.name),e=e.replace("{{name}}","the "+c.inputEndpoint._parent.name);var f=o.cloneNode(!0);f.querySelector("*[data-description]").innerHTML="When "+e+", "+d,f.querySelector('input[type="checkbox"]')._connection=c,i.appendChild(f),k.push(c)})}),k.length>0&&(n.classList.add("on"),f.addEventListener("click",d,!1),g.addEventListener("click",e,!1));var l={clear:function(){f.removeEventListener("click",d,!1),g.removeEventListener("click",e,!1),n.classList.remove("on")}};return l}function h(a,b,c,e){function f(){d.createSpecificOverlay(b)}function g(){d.createSpecificOverlay(a)}function h(){d.destroySpecificOverlay(b)}function i(){d.destroySpecificOverlay(a)}function j(a,b,c){Object.keys(b).forEach(function(d){var e=b[d],f=document.createElement("option"),g=e.description.replace("{{name}}","the "+c);f.appendChild(document.createTextNode(g)),f.title=""+d+" ("+e.type+")",f.value=d,a.appendChild(f)})}function k(){t.clear(),c&&c(p.value,q.value)}function l(){t.clear(),e&&e()}var n=a._appbuilder,o=b._appbuilder,p=m.querySelector("*[data-output-action]"),q=m.querySelector("*[data-input-action]"),r=m.querySelector('button[data-action="accept"]'),s=m.querySelector('button[data-action="cancel"]');p.innerHTML="",q.innerHTML="",j(p,n.definition.outputs,n.name),j(q,o.definition.inputs,o.name),q.addEventListener("mouseover",f,!1),p.addEventListener("mouseover",g,!1),q.addEventListener("mouseout",h,!1),p.addEventListener("mouseout",i,!1),r.addEventListener("click",k,!1),s.addEventListener("click",l,!1);var t={clear:function(){q.removeEventListener("mouseover",f,!1),p.removeEventListener("mouseover",g,!1),q.removeEventListener("mouseout",h,!1),p.removeEventListener("mouseout",i,!1),r.removeEventListener("click",k,!1),s.removeEventListener("click",l,!1),m.classList.remove("on")}};return m.classList.add("on"),t}function i(a){var b;for(b=a.parentNode;b&&-1===k.indexOf(b);)b=b.parentNode;if(b||a.hasAttribute("from")&&(b=document.querySelector(a.getAttribute("from"))),b){var c=a.getAttribute("to"),d=a.getAttribute("out"),e=a.getAttribute("in"),f=document.querySelector(c);f&&d&&e&&f._appbuilder&&b._appbuilder.connectOutput(d,f._appbuilder,e)}}function j(){l=c.getDomFragmentFromString(a),m=l.querySelector(".webmaker-appbuilder-connection-sentence").cloneNode(!0),n=l.querySelector(".webmaker-appbuilder-connection-list").cloneNode(!0),o=n.querySelector(".connection-details"),document.body.appendChild(m),document.body.appendChild(n),o.parentNode.removeChild(o),window.addEventListener("appbuilderloaded",function(){setTimeout(function(){var a=Array.prototype.slice.call(document.querySelectorAll("appbuilder-connection")).concat(p);a.forEach(i)},100)},!1);var b=document.createEvent("CustomEvent");b.initCustomEvent("appbuilderloaded",!1,!1,q),window.dispatchEvent(b)}var k=[];c.attachCSSFromString(b);var l,m,n,o,p=[],q=window.appbuilder={createElementOverlays:function(){d.createOverlays()},updateStateListenersOnConnect:function(a){a.events.on("connect",function(b){Object.keys(a.states).forEach(function(c){b.detail.type===c&&a.states[c]&&b.detail.connection.send()})})},initElement:function(a,b){function c(b){function e(){window.removeEventListener("mouseup",e,!1),a.addEventListener("mousedown",c,!1),clearTimeout(j)}function f(){window.removeEventListener("mouseup",f,!1),a.addEventListener("mousedown",c,!1);var b=d.stopDrawingPath();d.destroyOverlays(),b&&(b!==a?h(a,b,function(c,e){a._appbuilder.connectOutput(c,b._appbuilder,e),d.destroyOverlays()},function(){d.destroyOverlays()}):g(a,function(a){a.forEach(function(a){i.disconnectOutput(a)})}))}if(1===b.which){b.stopPropagation(),b.preventDefault();var j=-1,k=b.clientX,l=b.clientY;j=setTimeout(function(){window.removeEventListener("mouseup",e,!1),window.addEventListener("mouseup",f,!1),d.createOverlays(),d.startDrawingPath(k+document.body.scrollLeft,l+document.body.scrollTop),j=-1},500),window.addEventListener("mouseup",e,!1),a.removeEventListener("mousedown",c,!1)}}if(b=b||a._appbuilder,!b)throw"No definition found for element.";var i=a._appbuilder={};return i.events=e.createEventManager(),i.connections=f.createEndpoint(i,function(a,b){i.events.dispatch("receive:"+a,b)}),a.id=a.id||"appbuilder-element-"+k.length,i.name=a.name||a.getAttribute("name")||a.id||a.tagName,i.definition=b,i.states=b.states||{},i.onInput=function(a,b){i.events.on("receive:"+a,function(a){b(a.data||a.detail)})},i.offInput=function(){},i.sendOutput=function(a,b){i.connections.send(a,b)},i.connectOutput=function(a,b,c){var d=f.createConnection(i.connections,a,b.connections,c);i.connections.addOutputConnection(d),b.connections.addInputConnection(d),i.events.dispatch("connect",{to:b,type:a,connection:d})},i.findAndDisconnectOutput=function(a,b,c){var d=i.connections.getOutputConection(a,from,c);d&&(i.removeOutputConnection(d),b.connections.removeInputConnection(d)),i.events.dispatch("disconnect",b)},i.disconnectOutput=function(a){i.connections.removeOutputConnection(a),a.inputEndpoint.removeInputConnection(a)},d.addElement(a),a.addEventListener("mousedown",c,!1),k.push(a),i.definition.connectionElements&&i.definition.connectionElements.length&&"string"!=typeof i.definition.connectionElements&&Array.prototype.slice.call(i.definition.connectionElements).forEach(function(b){var c=a.id?"#"+a.id:a.name?a.tagName+'[name="'+a.name+'"]':"";b.setAttribute("from",c),p.push(b)}),i}};return document.body&&["complete","interactive"].indexOf(document.readyState>-1)?setTimeout(j,100):document.addEventListener("DOMContentLoaded",j,!1),q});